<!DOCTYPE html>
<html>
<head>
  <title>Generate Entry</title>
</head>
<body>
  <h1>Create a Workpad</h1>
  <form id="entry-form">
    <label>Title: <input type="text" id="title" required></label><br>
    <label>Date: <input type="date" id="date" required></label><br>
    <label>Summary:</label><br>
    <textarea id="summary" rows="8" cols="40" required></textarea><br>
    <button type="submit">Generate Link</button>
  </form>
  <p id="output"></p>

  <script src="https://unpkg.com/pako@latest/dist/pako.min.js"></script>
  <script>
    function toBase64(uint8array) {
      return btoa(String.fromCharCode(...uint8array));
    }

    function encodeData(obj) {
      const json = JSON.stringify(obj);
      const compressed = pako.brotliCompress(json);
      return toBase64(compressed);
    }

    document.getElementById('entry-form').onsubmit = function (e) {
      e.preventDefault();

      const title = document.getElementById('title').value;
      const date = document.getElementById('date').value;
      const summary = document.getElementById('summary').value;

      const payload = encodeData({ title, date, summary });
      const viewUrl = `${location.origin}/view.html#${payload}`;
      
      document.getElementById('output').innerHTML = `<a href="${viewUrl}">Open Workpad</a>`;
    };
  </script>
</body>
</html>
